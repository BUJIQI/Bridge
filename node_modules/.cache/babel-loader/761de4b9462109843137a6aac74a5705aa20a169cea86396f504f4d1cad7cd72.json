{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { useUserStore } from '@/store/user';\nimport { ref, reactive, onMounted } from 'vue';\nimport axios from '@/api/axios';\nimport { useRouter } from 'vue-router';\nexport default {\n  setup() {\n    const userStore = useUserStore();\n    const userInfo = userStore.userInfo;\n    const router = useRouter();\n    const userProfile = reactive({\n      name: userInfo.username,\n      studentId: userInfo.stuid,\n      teamName: userInfo.team_name,\n      class: userInfo.user_class,\n      group: userInfo.group,\n      company: userInfo.number,\n      password: '',\n      phone: '',\n      email: ''\n    });\n    const editingProfile = reactive({\n      name: '',\n      studentId: '',\n      teamName: '',\n      class: '',\n      group: '',\n      company: '',\n      password: '',\n      phone: '',\n      email: ''\n    });\n    const isEditing = ref(false);\n    const ongoingGames = ref([]);\n    const historyGames = ref([]);\n    const toggleEditMode = () => {\n      isEditing.value = !isEditing.value;\n      if (isEditing.value) {\n        Object.assign(editingProfile, userProfile);\n      }\n    };\n    const cancelEdit = () => {\n      isEditing.value = false;\n    };\n    const saveProfile = () => {\n      Object.assign(userProfile, editingProfile);\n      isEditing.value = false;\n    };\n\n    // 在组件挂载时发送GET请求\n    onMounted(async () => {\n      try {\n        const response = await axios.get('/users/user_data/', {\n          withCredentials: true\n        });\n        const data = response.data;\n\n        // 处理历史轮次\n        if (data.history_rounds !== \"无历史对局\") {\n          historyGames.value = Object.entries(data.history_rounds).map(([endTime, details]) => ({\n            id: Date.now() + Math.random(),\n            // 生成唯一的id\n            endTime: endTime,\n            endCycle: details[\"结束周期\"],\n            finalRating: details[\"末周期评分\"],\n            rank: `${details[\"名次\"]}/2`\n          })).slice(0, 5);\n        } else {\n          historyGames.value = [];\n        }\n\n        // 处理当前周期\n        ongoingGames.value = Object.entries(data.current_rounds).map(([startTime, details]) => ({\n          id: Date.now() + Math.random(),\n          // 生成唯一的id\n          startTime: startTime,\n          currentCycle: details[\"当前周期\"],\n          finalRating: details[\"末周期评分\"],\n          rank: `${details[\"名次\"]}/2`\n        }));\n      } catch (error) {\n        console.error(\"获取用户数据失败:\", error);\n      }\n    });\n    const goToDecisionInput = gameId => {\n      router.push({\n        path: '/decision/input',\n        query: {\n          gameId: gameId\n        }\n      });\n    };\n    const viewMoreAll = () => {\n      router.push({\n        path: '/profile/all-history-games'\n      });\n    };\n    return {\n      userProfile,\n      editingProfile,\n      isEditing,\n      ongoingGames,\n      historyGames,\n      toggleEditMode,\n      cancelEdit,\n      saveProfile,\n      goToDecisionInput,\n      viewMoreAll\n    };\n  }\n};","map":{"version":3,"names":["useUserStore","ref","reactive","onMounted","axios","useRouter","setup","userStore","userInfo","router","userProfile","name","username","studentId","stuid","teamName","team_name","class","user_class","group","company","number","password","phone","email","editingProfile","isEditing","ongoingGames","historyGames","toggleEditMode","value","Object","assign","cancelEdit","saveProfile","response","get","withCredentials","data","history_rounds","entries","map","endTime","details","id","Date","now","Math","random","endCycle","finalRating","rank","slice","current_rounds","startTime","currentCycle","error","console","goToDecisionInput","gameId","push","path","query","viewMoreAll"],"sources":["D:\\当下文件\\python\\Bridge-1\\src\\components\\UserProfile.vue"],"sourcesContent":["<template>\r\n    <div class=\"panel panel-default mt-3\">\r\n        <div class=\"panel-body\">\r\n            <div class=\"row h-100\">\r\n                <div class=\"col-md-4\">\r\n                    <div class=\"user-profile\" v-if=\"!isEditing\">\r\n                        <h4 class=\"card-header\">个人信息</h4>\r\n                        <hr> <!-- 添加分割线 -->\r\n                        <p><strong>姓名:</strong> {{ userProfile.name }}</p>\r\n                        <p><strong>学号:</strong> {{ userProfile.studentId }}</p>\r\n                        <p><strong>队名:</strong> {{ userProfile.teamName }}</p>\r\n                        <p><strong>班级:</strong> {{ userProfile.class }}</p>\r\n                        <p><strong>组:</strong> 第{{ userProfile.group }}组</p>\r\n                        <p><strong>企业:</strong> 第{{ userProfile.company }}企业</p>\r\n                        <button class=\"btn btn-primary\" @click=\"toggleEditMode\">编辑资料</button>\r\n                    </div>\r\n\r\n                    <div class=\"edit-form\" v-if=\"isEditing\">\r\n                        <h4 class=\"card-header\">编辑个人资料</h4>\r\n                        <hr> <!-- 添加分割线 -->\r\n                        <div class=\"form-group\">\r\n                            <label for=\"name\">姓名</label>\r\n                            <input type=\"text\" class=\"form-control\" id=\"name\" v-model=\"editingProfile.name\">\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label for=\"studentId\">学号</label>\r\n                            <input type=\"text\" class=\"form-control\" id=\"studentId\" v-model=\"editingProfile.studentId\">\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label for=\"teamName\">队名</label>\r\n                            <input type=\"text\" class=\"form-control\" id=\"teamName\" v-model=\"editingProfile.teamName\">\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label for=\"class\">班级</label>\r\n                            <input type=\"text\" class=\"form-control\" id=\"class\" v-model=\"editingProfile.class\">\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label for=\"password\">密码</label>\r\n                            <input type=\"password\" class=\"form-control\" id=\"password\" v-model=\"editingProfile.password\">\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label for=\"phone\">手机</label>\r\n                            <input type=\"tel\" class=\"form-control\" id=\"phone\" v-model=\"editingProfile.phone\">\r\n                        </div>\r\n                        <div class=\"form-group\">\r\n                            <label for=\"email\">邮箱</label>\r\n                            <input type=\"email\" class=\"form-control\" id=\"email\" v-model=\"editingProfile.email\">\r\n                        </div>\r\n                        <button type=\"button\" class=\"btn btn-secondary\" @click=\"cancelEdit\">取消</button>\r\n                        <button type=\"button\" class=\"btn btn-thirdly\" @click=\"saveProfile\">保存</button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div class=\"col-md-8\">\r\n                    <div class=\"table-container\">\r\n                        <div class=\"header\">正在进行的对局</div>\r\n                        <table>\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>开始时间</th>\r\n                                    <th>当前周期</th>\r\n                                    <th>末周期评分</th>\r\n                                    <th>名次</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <tr v-for=\"game in ongoingGames\" :key=\"game.id\" @click=\"goToDecisionInput(game.id)\">\r\n                                    <td>{{ game.startTime }}</td>\r\n                                    <td>{{ game.currentCycle }}</td>\r\n                                    <td>{{ game.finalRating === '未评分' ? '-' : game.finalRating }}</td>\r\n                                    <td>{{ game.rank === '未评分/2' ? '-' : game.rank }}</td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n\r\n                    <div class=\"table-container\">\r\n                        <div class=\"header\">\r\n                            历史对局\r\n                            <div class=\"view-more-container\" @click=\"viewMoreAll\">\r\n                                查看更多\r\n                                <span class=\"arrow\"></span>\r\n                            </div>\r\n                        </div>\r\n                        <table>\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>结束时间</th>\r\n                                    <th>结束周期</th>\r\n                                    <th>末周期评分</th>\r\n                                    <th>名次</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <tr v-for=\"game in historyGames\" :key=\"game.id\">\r\n                                    <td>{{ game.endTime }}</td>\r\n                                    <td>{{ game.endCycle }}</td>\r\n                                    <td>{{ game.finalRating === '未评分' ? '-' : game.finalRating }}</td>\r\n                                    <td>{{ game.rank === '未评分/2' ? '-' : game.rank }}</td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport { useUserStore } from '@/store/user';\r\nimport { ref, reactive, onMounted } from 'vue';\r\nimport axios from '@/api/axios';\r\nimport { useRouter } from 'vue-router';\r\n\r\nexport default {\r\n    setup() {\r\n        const userStore = useUserStore();\r\n        const userInfo = userStore.userInfo;\r\n        const router = useRouter();\r\n        const userProfile = reactive({\r\n            name: userInfo.username,\r\n            studentId: userInfo.stuid,\r\n            teamName: userInfo.team_name,\r\n            class: userInfo.user_class,\r\n            group: userInfo.group,\r\n            company: userInfo.number,\r\n            password: '',\r\n            phone: '',\r\n            email: ''\r\n        });\r\n\r\n        const editingProfile = reactive({\r\n            name: '',\r\n            studentId: '',\r\n            teamName: '',\r\n            class: '',\r\n            group: '',\r\n            company: '',\r\n            password: '',\r\n            phone: '',\r\n            email: ''\r\n        });\r\n\r\n        const isEditing = ref(false);\r\n        const ongoingGames = ref([]);\r\n        const historyGames = ref([]);\r\n\r\n        const toggleEditMode = () => {\r\n            isEditing.value = !isEditing.value;\r\n            if (isEditing.value) {\r\n                Object.assign(editingProfile, userProfile);\r\n            }\r\n        };\r\n\r\n        const cancelEdit = () => {\r\n            isEditing.value = false;\r\n        };\r\n\r\n        const saveProfile = () => {\r\n            Object.assign(userProfile, editingProfile);\r\n            isEditing.value = false;\r\n        };\r\n\r\n        // 在组件挂载时发送GET请求\r\n        onMounted(async () => {\r\n            try {\r\n                const response = await axios.get('/users/user_data/', {withCredentials: true});\r\n                const data = response.data;\r\n\r\n                // 处理历史轮次\r\n                if (data.history_rounds !== \"无历史对局\") {\r\n                    historyGames.value = Object.entries(data.history_rounds).map(([endTime, details]) => ({\r\n                        id: Date.now() + Math.random(), // 生成唯一的id\r\n                        endTime: endTime,\r\n                        endCycle: details[\"结束周期\"],\r\n                        finalRating: details[\"末周期评分\"],\r\n                        rank: `${details[\"名次\"]}/2`\r\n                    })).slice(0, 5);\r\n                } else {\r\n                    historyGames.value = [];\r\n                }\r\n\r\n                // 处理当前周期\r\n                ongoingGames.value = Object.entries(data.current_rounds).map(([startTime, details]) => ({\r\n                    id: Date.now() + Math.random(), // 生成唯一的id\r\n                    startTime: startTime,\r\n                    currentCycle: details[\"当前周期\"],\r\n                    finalRating: details[\"末周期评分\"],\r\n                    rank: `${details[\"名次\"]}/2`\r\n                }));\r\n\r\n            } catch (error) {\r\n                console.error(\"获取用户数据失败:\", error);\r\n            }\r\n        });\r\n\r\n        const goToDecisionInput = (gameId) => {\r\n            router.push({ path: '/decision/input', query: { gameId: gameId } });\r\n        };\r\n\r\n        const viewMoreAll = () => {\r\n            router.push({ path: '/profile/all-history-games' });\r\n        };        \r\n\r\n        return {\r\n            userProfile,\r\n            editingProfile,\r\n            isEditing,\r\n            ongoingGames,\r\n            historyGames,\r\n            toggleEditMode,\r\n            cancelEdit,\r\n            saveProfile,\r\n            goToDecisionInput,\r\n            viewMoreAll\r\n        };\r\n    }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.panel {\r\n    margin-top: 20px;\r\n    border-radius: 8px;\r\n}\r\n\r\n.panel-body {\r\n    padding: 15px;\r\n}\r\n\r\n.user-profile {\r\n    background-color: #f8f9fa; \r\n    padding: 20px;\r\n    border: 1px solid #ddd;\r\n    border-radius: 5px;\r\n}\r\n\r\n.user-name {\r\n    font-size: 24px;\r\n    color: #333; \r\n    margin-bottom: 10px;\r\n}\r\n\r\n.btn-primary {\r\n    background-color: #c00; \r\n    border-color: #c00;  \r\n}\r\n\r\n.btn-primary:hover,\r\n.btn-primary:focus {\r\n    background-color: rgb(190, 0, 0); \r\n    border-color: rgb(190, 0, 0);\r\n}\r\n\r\n.btn-secondary {\r\n    background-color: #6c757d; \r\n    border-color: #6c757d;\r\n    color: #fff;\r\n    margin: 10px 10px 0 0;\r\n}\r\n\r\n.btn-secondary:hover,\r\n.btn-secondary:focus {\r\n    background-color: #545b62;\r\n    border-color: #545b62;\r\n}\r\n\r\n.btn-thirdly {\r\n    background-color: #c00; \r\n    border-color: #c00; \r\n    color: #fff;\r\n    margin: 10px 0 0 0;\r\n}\r\n\r\n.btn-thirdly:hover,\r\n.btn-thirdly:focus {\r\n    background-color: rgb(190, 0, 0); \r\n    border-color: rgb(190, 0, 0);\r\n}\r\n\r\n.edit-form {\r\n    background-color: #f8f9fa; \r\n    padding: 20px;\r\n    border: 1px solid #ddd;\r\n    border-radius: 5px;\r\n}\r\n\r\n.table-container {\r\n    background-color: #f8f9fa;\r\n    border: 1px solid #ddd;\r\n    border-radius: 5px;\r\n    padding: 10px;\r\n    margin-bottom: 50px;\r\n}\r\n\r\n.table-container .header {\r\n    font-size: 18px;\r\n    color: #333;\r\n    margin-bottom: 10px;\r\n}\r\n\r\n.table-container table {\r\n    width: 100%;\r\n    border-collapse: collapse;\r\n}\r\n\r\n.table-container th, .table-container td {\r\n    border: 1px solid #ddd;\r\n    padding: 8px;\r\n    text-align: left;\r\n}\r\n\r\n.table-container th {\r\n    background-color: rgb(197, 107, 107);\r\n    color: white;\r\n}\r\n\r\n.table-container tr:nth-child(even) {\r\n    background-color: #f2f2f2;\r\n}\r\n\r\n.table-container tr:hover {\r\n    background-color: #ddd;\r\n}\r\n\r\n.header {\r\n    position: relative;  \r\n}\r\n\r\n.table-container .header::after {\r\n    content: \"\";\r\n    display: table;\r\n    clear: both;\r\n}\r\n\r\n.view-more-container {\r\n    float: right;\r\n    cursor: pointer;\r\n    font-size: 16px;\r\n    display: flex;\r\n    align-items: center;\r\n    color:#444;\r\n}\r\n\r\n.arrow {\r\n  display: inline-block;\r\n  width: 8px;\r\n  height: 8px;\r\n  border-bottom: 1.5px solid #444; \r\n  border-right: 1.5px solid #444; \r\n  transform: rotate(-45deg);\r\n  transition: transform 0.3s ease;\r\n  margin-left: 4px; \r\n}\r\n\r\n.view-more-container:hover {\r\n  color: #000000;\r\n}\r\n\r\n.view-more-container:hover .arrow {\r\n  border-bottom: 1.5px solid #000000; \r\n  border-right: 1.5px solid #000000; \r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}